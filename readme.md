# Snowflake

[Twitter Snowflake](https://github.com/twitter/snowflake) for PHP implementation.

## Installation

```bash
composer require chivincent/snowflake
```

## Usage

```php
<?php

require __DIR__ . '/vendor/autoload.php';

use Chivincent\Snowflake\Snowflake;

$snowflake = new Snowflake();

// Generate 10 unique IDs
$snowflake->gen(10);
$snowflake(1000);

// Generate 1000 unique IDs
$snowflake->gen(10);
$snowflake(1000);
```

## Description

### How's the return value?

It is an array contains 1 or more 64 bits integer, which can be store in MySQL as bigint data type.

### How's it can be "UNIQUE" in the same request?

The value is generated by millisecond, machine id and sequence number. 

When use it on more then one machine , you should set `MACHINE_ID`(0 ~ 8191) as your local environment.

In the same millisecond, it will use Sequence for promising the value is unique.

### How's the data store in the 64 bits number?

```text

+---------------------------------+----------------------+-------------------+
| millisecond timestamp (41 bits) | machine id (13 bits) | sequence (9 bits) |
+---------------------------------+----------------------+-------------------+

```

### Is it possible repeat?

Unfortunately, it is possible. 

When use it in PHP without ZTS (Zend Thread Safe), and more than one thread try to get ids in the same millisecond, it will cause race condition.

### How to resolve race condition?

You can overwrite `Chivincent\Snowflake\Sequence` public method `next()`, try to get sequence value from redis, memcache or any sequence generator which can be daemoned at memory.

## LICENSE

This library is under [MIT](https://opensource.org/licenses/MIT) LICENSE.
